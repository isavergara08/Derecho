<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Plan de Estudios - Derecho</title>
<style>
body{font-family:Arial,Helvetica,sans-serif;background:#f6f2fb;margin:0;padding:20px}
h1{text-align:center;font-weight:500}
#global{max-width:900px;margin:10px auto 20px;text-align:center}
#global .bar{height:14px;background:#ddd;border-radius:10px;overflow:hidden;margin-top:6px}
#global .bar div{height:100%;background:#9b7cff;width:0%}

.menu{text-align:center;margin:15px}
.menu button{padding:9px 20px;border:none;border-radius:20px;background:#e8d4ff;cursor:pointer;font-size:15px;margin:0 6px}
.menu .btn-gray{background:#e6e6e6;color:#555}

.grid{display:grid;grid-template-columns:repeat(3,1fr);gap:18px;max-width:1000px;margin:0 auto}
.semester{background:#fff;border-radius:14px;padding:12px;box-shadow:0 4px 10px rgba(0,0,0,.06)}
.semester h2{margin:0 0 6px;font-size:17px;display:flex;justify-content:space-between}
.semester h2 span{font-weight:700}

.subjects{min-height:40px}
.subject{background:#f1ecff;margin:6px 0;padding:6px 10px;border-radius:10px;cursor:grab;user-select:none}
.subject.approved{text-decoration:line-through;opacity:.6}
.subject input{width:100%;border:none;background:#fff;border-radius:6px;padding:4px}

.sem10{grid-column:2}
</style>
</head>
<body>

<h1>Plan de Estudios - Derecho</h1>

<div id="global">
  <div id="globalCredits">0 / 183</div>
  <div class="bar"><div id="globalBar"></div></div>
</div>

<div class="menu">
  <button onclick="resetApproved()">Reiniciar</button>
  <button class="btn-gray" onclick="formatAll()">Formatear</button>
</div>

<div class="grid" id="grid"></div>

<script>
const TOTAL_CREDITS = 183;

const baseSemesters = Array.from({length:10},(_,i)=>({
  name:`Semestre ${i+1}`,
  subjects:[
    {name:`Materia ${i+1}.1`,credits:3,approved:false},
    {name:`Materia ${i+1}.2`,credits:3,approved:false}
  ]
}));

let semesters = JSON.parse(JSON.stringify(baseSemesters));

function save(){localStorage.setItem('malla',JSON.stringify(semesters))}

function load(){
  const data = JSON.parse(localStorage.getItem('malla'));
  if(data && data.length===10) semesters=data;
}

function render(){
  const grid=document.getElementById('grid');
  grid.innerHTML='';
  let globalApproved=0;

  semesters.forEach((sem,i)=>{
    const box=document.createElement('div');
    box.className='semester'+(i===9?' sem10':'');

    let approved=0,total=0;
    sem.subjects.forEach(s=>{total+=s.credits;if(s.approved) approved+=s.credits});
    globalApproved+=approved;

    box.innerHTML=`<h2>${sem.name}<span>${approved}/${total}</span></h2>`;

    const list=document.createElement('div');
    list.className='subjects';
    list.ondragover=e=>e.preventDefault();
    list.ondrop=e=>{
      const data=JSON.parse(e.dataTransfer.getData('text'));
      const from=semesters[data.sem].subjects.splice(data.idx,1)[0];
      sem.subjects.splice(data.pos,0,from);
      save();render();
    };

    sem.subjects.forEach((sub,idx)=>{
      const d=document.createElement('div');
      d.className='subject'+(sub.approved?' approved':'');
      d.draggable=true;
      d.textContent=sub.name;

      d.onclick=()=>{sub.approved=!sub.approved;save();render()};

      d.ondblclick=(e)=>{
        e.stopPropagation();
        const input=document.createElement('input');
        input.value=sub.name;
        d.innerHTML='';
        d.appendChild(input);
        input.focus();
        input.onkeydown=ev=>{
          if(ev.key==='Enter'){sub.name=input.value;save();render()}
          if(ev.key==='Escape'){render()}
        };
        input.onblur=()=>{sub.name=input.value;save();render()};
      };

      d.ondragstart=e=>{
        const rect=d.getBoundingClientRect();
        const pos=idx;
        e.dataTransfer.setData('text',JSON.stringify({sem:i,idx,pos}));
      };

      list.appendChild(d);
    });

    box.appendChild(list);
    grid.appendChild(box);
  });

  document.getElementById('globalCredits').textContent=`${globalApproved} / ${TOTAL_CREDITS}`;
  document.getElementById('globalBar').style.width=(globalApproved/TOTAL_CREDITS*100)+'%';
}

function resetApproved(){
  semesters.forEach(s=>s.subjects.forEach(m=>m.approved=false));
  save();render();
}

function formatAll(){
  semesters=JSON.parse(JSON.stringify(baseSemesters));
  save();render();
}

load();render();
</script>
</body>
</html>
